仕様書駆動開発のフェーズ2として、実装計画書をもとにコードスタイルとアーキテクチャを理解した上で実装を行い、テストを通し、リファクタリングとコードレビューを実施し、実装結果レポートを作成しマークダウンファイルに保存することが最終目的です。このフェーズは実際のコードを書く重要な段階であり、TDDのRed-Green-Refactorサイクルを意識して進めることで、品質の高いコードを実現します。ルール、手順に慎重に従い、実装と実装結果レポートを作成してください。

## ルール
- 実装計画書に記載された実装セットごとに作業を行い、まとめて作業は絶対にしてはいけません。クオリティが下がる原因になります。
- TDDのRed-Green-Refactorサイクルを意識して実装しなさい。
  - Red: 失敗するテストを最初に書く
  - Green: テストを通す最小限の実装を行う
  - Refactor: テストが通る状態を保ちながらコードを改善する
- 実装計画書に記載されている各実装セットの手順を必ず順番に実行しなさい。
- 実装計画書のチェックリスト項目が完了したら、`- []`を`- [x]`に変更しなさい。
- 実装計画書に記載された実装内容から逸脱しないように注意しなさい。
- コードスタイルドキュメントに記載されたルールに必ず従いなさい。
- アーキテクチャドキュメントに記載された設計原則に必ず従いなさい。
- 実装結果レポートは実装セットごとに更新します。無理にまとめて作業はしてはいけません。
- アーキテクチャは(https://github.com/noaqh-corp/dev/blob/main/docs/architecture.md)から取得しなさい。
- コードスタイルは(https://raw.githubusercontent.com/noaqh-corp/dev/refs/heads/main/prompts/code-style-review.md)から取得しなさい。
- 実装結果レポートテンプレートは(https://raw.githubusercontent.com/noaqh-corp/dev/refs/heads/main/docs/implementation_report_template.md)から取得しなさい。
- 実装結果レポートは`spec/{feature_number}-{feature_name}/implementation_report.md`に保存しなさい。
- 完了報告前には必ずテストを通しておくこと。
- 完了報告前には実装セットをすべて完了させること。

## ディレクトリ構成
- spec/{feature_number}-{feature_name}/
    - plan.md # フェーズ1で作成した実装計画書
    - implementation_report.md # フェーズ2で作成する実装結果レポート

## 手順
1. `spec/{feature_number}-{feature_name}/plan.md`を読み込み、実装計画書の内容を完全に理解しなさい。実装計画書には実装セットごとの詳細な手順が記載されています。これらの手順は必ず順番に実行する必要があります。
2. コードスタイルドキュメントを取得し、コードスタイルを完全に理解しなさい。コードスタイルドキュメントには例示が多く含まれています。この例示は非常に重要なので尊重されていることを確認しなさい。
3. アーキテクチャドキュメントを取得し、アーキテクチャを完全に理解しなさい。アーキテクチャドキュメントには例示が多く含まれています。この例示は非常に重要なので尊重されていることを確認しなさい。
4. 実装結果レポートテンプレートを取得し、テンプレートの構造を理解しなさい。
5. `spec/{feature_number}-{feature_name}/implementation_report.md`を作成し、テンプレートに従って初期状態を作成しなさい。
6. 実装計画書に記載された実装セットごとに以下の手順を実行しなさい。すべての実装セットに対して順番に作業を行い、まとめて作業は絶対にしてはいけません。
   6-1. 実装セットで行うべき内容を理解しなさい。実装計画書に記載されている実装セットの説明、実装内容、手順を確認しなさい。
   6-2. 実装セットの手順に従って、TDDのRed-Green-Refactorサイクルを意識しながら実装を行いなさい。
        - Red: 実装セットで実装すべき機能に対して、失敗するテストを最初に書きなさい。
        - Green: テストを通す最小限の実装を行いなさい。この段階では、テストが通ることを最優先にしなさい。
        - Refactor: テストが通る状態を保ちながら、コードスタイルとアーキテクチャに沿った形にコードを改善しなさい。
   6-3. 実装したコードがコードスタイルドキュメントに沿っているかを確認しなさい。違反があれば修正しなさい。
   6-4. 実装したコードがアーキテクチャドキュメントに沿っているかを確認しなさい。違反があれば修正しなさい。
   6-5. テストを実行し、すべてのテストが通ることを確認しなさい。テストが失敗する場合は、原因を特定し修正しなさい。
   6-6. 実装計画書の実装セットに対応するチェックリスト項目を完了し、`- []`を`- [x]`に変更しなさい。
   6-7. 実装結果レポートを更新し、実装セットで実装した内容、動作確認の結果、発見した課題などを記載しなさい。
   6-8. 実装セットでの作業が完了したら、ユーザーに進捗を報告しなさい。必要に応じて、実装計画書に記載されていない技術的な選択が必要な場合は、ユーザーに確認を求めなさい。
7. すべての実装セットの作業が完了したら、実装結果レポートを完成させ、以下の観点で最終確認を行いなさい。
   7-1. 実装計画書に記載されたすべての実装セットが完了しているかを確認しなさい。
   7-2. 実装計画書通りに実装されているかを確認しなさい。
   7-3. コードスタイルドキュメントに沿っているかを確認しなさい。
   7-4. アーキテクチャドキュメントに沿っているかを確認しなさい。
   7-5. すべてのテストが通っているかを確認しなさい。
   7-6. 実装結果レポートに実装内容の詳細、動作確認の結果、残タスク、所感・課題・次のアクションが適切に記載されているかを確認しなさい。
8. 最終確認で問題があれば修正し、問題がなければ実装結果レポートをユーザーに報告しなさい。

## TDDのRed-Green-Refactorサイクルについて

TDD（テスト駆動開発）は、実装の品質を高めるための重要な手法です。以下の3つのステップを繰り返すことで、確実に動作するコードを実装できます。

### Red（レッド）
- 実装すべき機能に対して、失敗するテストを最初に書きなさい。
- テストは、実装すべき機能の振る舞いを明確に定義するものであるべきです。
- この段階では、テストが失敗することを確認することが重要です。

### Green（グリーン）
- テストを通す最小限の実装を行いなさい。
- この段階では、コードの品質よりもテストが通ることを最優先にしなさい。
- テストが通ることを確認しなさい。

### Refactor（リファクタリング）
- テストが通る状態を保ちながら、コードを改善しなさい。
- コードスタイルドキュメントに沿った形にコードを整形しなさい。
- アーキテクチャドキュメントに沿った形にコードを再構成しなさい。
- 重複したコードを削除し、可読性を向上させなさい。
- リファクタリング後も、テストが通ることを確認しなさい。

## 実装時の注意事項

### コードスタイルの遵守
- コードスタイルドキュメントに記載された命名規則、フォーマット規則、構造規則を必ず守りなさい。
- 特に例示されているコードパターンは重要な参考になるので、積極的に参照しなさい。

### アーキテクチャの遵守
- アーキテクチャドキュメントに記載された設計原則、ディレクトリ構造、ファイル配置規則を必ず守りなさい。
- command、query、flowの構造に従って実装しなさい。
- 特に例示されているアーキテクチャパターンは重要な参考になるので、積極的に参照しなさい。

### 実装計画書からの逸脱を避ける
- 実装計画書に記載されていない機能を勝手に追加してはいけません。
- 実装計画書に記載されている実装内容から逸脱しないように注意しなさい。
- 実装計画書に記載されていない技術的な選択が必要な場合は、必ずユーザーに確認を求めなさい。

### テストの重要性
- すべての実装に対して、適切なテストを書きなさい。
- テストは、実装した機能が正しく動作することを確認するものであるべきです。
- エラーハンドリングもテストで確認しなさい。

### 実装結果レポートの更新
- 各実装セットが完了したら、実装結果レポートを更新しなさい。
- 実装内容の詳細、動作確認の結果、発見した課題などを適切に記載しなさい。
- 実装結果レポートは、後から参照される重要なドキュメントです。

## 実装結果レポートの記入例

```
## 実装内容の詳細

### 実装セット1: クーポンの有効期限検証機能
- features/coupon/query/validate-expiration-date-coupon.tsを実装
- クーポンの有効期限が過ぎているかを検証するクエリを追加
- テストコードを追加し、有効期限が過ぎている場合と過ぎていない場合の両方をテスト

### 実装セット2: クーポンの利用回数更新機能
- features/coupon/command/update-total-usage-coupon.tsを実装
- クーポンの利用回数を更新するコマンドを追加
- テストコードを追加し、正常系と異常系の両方をテスト

## 動作確認
- すべてのユニットテストが通過することを確認
- クーポンの有効期限検証機能が正しく動作することを確認
- クーポンの利用回数更新機能が正しく動作することを確認

## 残タスク
- 統合テストの追加（次のフェーズで対応予定）

## 所感・課題・次のアクション
- 実装計画書に沿って実装を進めることで、迷うことなく実装を進めることができた
- コードスタイルとアーキテクチャを事前に理解していたことで、一貫性のあるコードを書くことができた
- 次のフェーズでは、統合テストの追加を検討する
```

## ユーザーからの要求
$ARGUMENTS

