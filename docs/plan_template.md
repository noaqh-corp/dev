# 機能仕様書: [機能名]

機能名: `[feature_number]-[feature_name]`  
作成日: [日付]  
仕様書テンプレートバージョン: 1.0.1

## ユーザーシナリオ & テスト *(必須)*

<!--
  重要: ユーザーストーリーは重要度順にユーザージャーニーとして優先順位付けする必要があります。
  各ユーザーストーリー/ジャーニーは独立してテスト可能である必要があります - つまり、そのうちの1つだけを実装しても、
  価値を提供する実行可能なMVP（最小実行可能製品）を持つべきです。
  すべてのユーザーシナリオを網羅し、考慮漏れが無いように注意深く作成してください。
  
  各ストーリーに優先度（P1、P2、P3など）を割り当て、P1が最も重要です。
  各ストーリーを以下が可能な独立した機能スライスとして考えてください:
  - 独立して開発可能
  - 独立してテスト可能
  - 独立してデプロイ可能
  - 独立してユーザーにデモ可能
-->

### ユーザーストーリー 1 - [簡潔なタイトル] (優先度: P1)

[このユーザージャーニーを平易な言葉で説明]

この優先度の理由: [価値とこの優先度レベルの理由を説明]

独立テスト: [これを独立してテストする方法を説明 - 例: "[特定のアクション]によって完全にテストでき、[特定の価値]を提供する"]

受け入れシナリオ:

1. 前提条件 [初期状態]、実行 [アクション]、期待結果 [期待される結果]
2. 前提条件 [初期状態]、実行 [アクション]、期待結果 [期待される結果]

---

### ユーザーストーリー 2 - [簡潔なタイトル] (優先度: P2)

[このユーザージャーニーを平易な言葉で説明]

この優先度の理由: [価値とこの優先度レベルの理由を説明]

独立テスト: [これを独立してテストする方法を説明]

受け入れシナリオ:

1. 前提条件 [初期状態]、実行 [アクション]、期待結果 [期待される結果]

---

### ユーザーストーリー 3 - [簡潔なタイトル] (優先度: P3)

[このユーザージャーニーを平易な言葉で説明]

この優先度の理由: [価値とこの優先度レベルの理由を説明]

独立テスト: [これを独立してテストする方法を説明]

受け入れシナリオ:

1. 前提条件 [初期状態]、実行 [アクション]、期待結果 [期待される結果]

---

[必要に応じて、それぞれに優先度を割り当てたユーザーストーリーを追加]

### エッジケース

<!--
  要対応: このセクションの内容はプレースホルダーです。
  適切なエッジケースで埋めてください。数が多ければ良いわけでなく、最低限のエッジケースを記載してください。
-->

- [境界条件]の場合、何が起こるか？
- システムは[エラーシナリオ]をどのように処理するか？

## 要件 *(必須)*

<!--
  要対応: このセクションの内容はプレースホルダーです。
  適切な機能要件で埋めてください。
-->

### 機能実装前後の変更点
#### 機能実装前
<!--
  要対応: このセクションの内容はプレースホルダーです。
  関連部分の実装前の状態を記載してください。
-->
#### 機能実装後
<!--
  要対応: このセクションの内容はプレースホルダーです。
  関連部分の実装後の状態を記載してください。
-->

### 機能要件

- FR-001: システムは[特定の機能、例: "ユーザーがアカウントを作成できる"]を提供しなければならない
- FR-002: システムは[特定の機能、例: "メールアドレスを検証する"]を提供しなければならない
- FR-003: ユーザーは[重要な操作、例: "パスワードをリセットする"]ことができなければならない
- FR-004: システムは[データ要件、例: "ユーザー設定を永続化する"]を満たさなければならない
- FR-005: システムは[動作、例: "すべてのセキュリティイベントをログに記録する"]を実行しなければならない

*不明確な要件をマークする例:*

- FR-006: システムは[要明確化: 認証方法が指定されていない - メール/パスワード、SSO、OAuth？]でユーザーを認証しなければならない
- FR-007: システムは[要明確化: 保持期間が指定されていない]期間、ユーザーデータを保持しなければならない

### エンティティ構造

<!--
  要対応: エンティティをどのように変更するかを明記してください。なぜ変更するかなども明記してください。
  変更が必要なエンティティはすべて明記してください。
  将来的に必要なカラムは考慮せず、絶対に必要なカラムのみを明記してください。

-->

<!--
  要対応: diffの形式でエンティティの変更点を明記してください。
  例: 
  ```diff
  + model User {
  +   id String @id @default(uuid())
  +   name String
  +   email String @unique
  +   password String
  + }
  ```
-->


## 成功基準 *(必須)*

<!--
  要対応: 測定可能な成功基準を定義してください。
  これらは技術に依存せず、測定可能である必要があります。
-->

### テスト項目
<!--
  要対応: 適切に分解されたテスト項目を定義してください。

  何を確認すべきかを明確にしてください。例えばfizzbuzzの場合は、
  - [] 数字を入力したら数字文字列としてが返るが、以下の場合は異なる値が返る
    - [] 3の倍数の場合はFizz
    - [] 5の倍数の場合はBuzz
    - [] 3と5の倍数の場合はFizzBuzz
  - [] 数字以外の場合はエラーがthrowされる

  ここでのポイントは必ず各テスト項目は独立してテスト可能である必要があり、実装する機能を簡潔かつ最低限かつ、必要十分に分解しMECEにしてください。
  
-->


### 型定義 *(新規型が必要な場合に含める)*

<!--
  要対応: 新規に定義が必要な型を明記してください。
  不要な型を作っていないかを注意深く確認してください。
-->

#### Domain固有型 (features/[domain]/types.ts)

- `[TypeName]`: [型の説明と使用箇所]

#### 共通型 (shared/types/types.ts)

- `[TypeName]`: [型の説明と使用箇所]

### 実装手順

<!--
  要対応: 実装手順を定義してください。
  ここではTDDを行い、テストを最初に書き、テストを通すための実装を書き、テストを通したらリファクタリングを行うことを行います。実装セットに分け、実装セット内ではTDDを行います。実装セットはモジュールごとに分け、順に実装を行えばすべての機能が実装できるようにしてください。
  各handlerなど実装は最上部にそのファイルに期待される動きを記載する必要があります。この内容は`// TASK: [実装内容]`というコメントで記載する必要があります。
  各実装セットはエントリーポイントがどのような仕様なのかも明記する。エントリーポイントは一つであることが望ましいが複数も可能。
  DTOは作らない。引数と返り値は明確に型を記載する。
  機能の実現に必要かつ、新規作成は編集が必要なcommand/query/flow/repository/serviceはすべて明記する。
-->

#### 実装セット0: Port/Adapter層 (必要な場合のみ)

<!--
  Repository/Serviceが必要な場合、最初に実装します。
  Port(インターフェース)とAdapter(実装)、Mock実装を含めます。
-->

##### Repository実装

- 対象ファイル:
  - `shared/port/[RepositoryName]Repository.ts` (新規追加)
  - `adapter/repository/[RepositoryName]Repository.ts` (新規追加)
  - `adapter/repository/mock/[RepositoryName]Repository.ts` (新規追加)
- 実装内容: [Repository実装の詳細]
- メソッド:
  - [メソッド名]([引数]): [返り値] ex: `getUser(userId: string): User`
- テスト項目:
  - [テスト項目(itと対応するように記載)]
- 手順:
  - [] Port(インターフェース)定義を作成
  - [] 本番実装を作成
  - [] Mock実装を作成
  - [] DIコンテナ(shared/container.ts)に登録

##### Service実装

- 対象ファイル:
  - `shared/port/[ServiceName]Service.ts` (新規追加)
  - `adapter/service/[ServiceName]Service.ts` (新規追加)
  - `adapter/service/mock/[ServiceName]Service.ts` (新規追加)
- メソッド:
  - [メソッド名]([引数]): [返り値] ex: `sendMessage(channelId: string, message: string): Promise<{ status: 'success' | 'error', messageId: string }>`
- テスト項目:
  - [テスト項目(itと対応するように記載)]
- 実装内容: [Service実装の詳細]
- 手順:
  - [] Port(インターフェース)定義を作成
  - [] 本番実装を作成
  - [] Mock実装を作成
  - [] DIコンテナ(shared/container.ts)に登録

#### 実装セット1: 型定義 (必要な場合のみ)

<!--
  新規型定義が必要な場合、features/<domain>/types.ts または shared/types/types.ts に定義します。
-->

- 対象ファイル:
  - `features/[domain]/types.ts` (新規追加 or 修正)
  - `shared/types/types.ts` (新規追加 or 修正)
- 実装内容: [型定義の詳細]
- 手順:
  - [] 必要な型を定義
  - [] Prisma/Zod生成型を使用する場合は手書き型として再定義

#### 実装セット2: [実装セット名]

<!--
  features/command, features/query, flows のいずれかの実装セット
-->

- 対象ファイル: [対象ファイル(複数可能)]
  - エントリーポイント:
    - [新規追加 or 修正: エントリーポイント1]
      - 関数: `[関数名]([引数]): [返り値]` ex: `getUserProfile(userId: string): User`
      - 実装前状態: `[実装前状態]`
      - 実装後状態: `[実装後状態]`
      - 実装内容: `[実装内容]`
      - 使用するPort: `[RepositoryName]Repository`, `[ServiceName]Service` など
- 対象テストファイル: 
  - [対象テストファイル(複数可能)]
    - テスト項目:
      - [テスト項目(itと対応するように記載)]
- 実装内容: [実装内容]
- 手順:
    - [] [TDDのRedステップ(絶対にテストを最初に書くこと。Mockを使用してPortの動作を再現)]
    - [] [TDDのGreenステップ(テストを通すための実装を書くこと。DIコンテナからPortを取得)]
    - [] [TDDのRefactorステップ(テストを通したらリファクタリングを行うこと)]

#### 実装セット3: [実装セット名]

- 対象ファイル: [対象ファイル(複数可能)]
  - エントリーポイント:
    - [新規追加 or 修正: エントリーポイント1]
      - 関数: `[関数名]([引数]): [返り値]` ex: `getUserProfile(userId: string): User`
      - 実装前状態: `[実装前状態]`
      - 実装後状態: `[実装後状態]`
      - 実装内容: `[実装内容]`
      - 使用するPort: `[RepositoryName]Repository`, `[ServiceName]Service` など
- 対象テストファイル: 
  - [対象テストファイル(複数可能)]
    - テスト項目:
      - [テスト項目(itと対応するように記載)]
- 実装内容: [実装内容]
- 手順:
    - [] [TDDのRedステップ(絶対にテストを最初に書くこと。Mockを使用してPortの動作を再現)]
    - [] [TDDのGreenステップ(テストを通すための実装を書くこと。DIコンテナからPortを取得)]
    - [] [TDDのRefactorステップ(テストを通したらリファクタリングを行うこと)]

### 影響ページ

<!--
  要対応: 影響ページを定義してください。
  ここでは影響ページを定義してください。
-->

- [影響ページ1] : [どのように影響を受けるか]

### 確認すべき項目
<!--
  要対応: ユーザーが動作確認を行うべき項目を定義してください。
  何を確認するべきか？は実装と同じくらい重要です。ユーザーが漏れなく動作確認し、問題があれば気がつけるように明記してください。
-->

#### ローカル確認できる項目
<!--
  要対応: ローカル確認できる項目を定義してください。
  - [項目1]: 
    確認すべき理由: {なぜ確認するべきか？}
    確認すべき内容:{何を確認するべきか？　あるべき状態や、期待する結果を明記してください。}
    確認方法:{どのように確認するべきか？　ローカルでの確認方法を明記してください。}
-->
#### デプロイ環境でのみ確認できる項目
<!--
  要対応: デプロイ環境でのみ確認できる項目を定義してください。
  - [項目1]: 
    確認すべき理由: {なぜ確認するべきか？}
    確認すべき内容:{何を確認するべきか？　あるべき状態や、期待する結果を明記してください。}
    確認方法:{どのように確認するべきか？　デプロイ環境での確認方法を明記してください。}
-->